language: node_js
node_js:
        - "node"

cache: yarn

before_install:
        - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.13.0 -export PATH="$HOME/.yarn/bin:$PATH"

install:
- yarn

services: 
        - docker

stages:
        - name: run test
          if: type = pull_request
        
        - name: docker build to docker hub
          if: type = push
        
jobs:
        include:
                - stage: run test
                  script: 
                        - yarn test
                
                - stage: docker build to docker hub
                  script:
                        - ./scripts/publish_docker_image.sh